<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#4f46e5" />
    
    <!-- PWA CONFIG -->
    <meta name="description" content="Marketplace pour produits digitaux et services freelance" />
    <meta name="keywords" content="digital, marketplace, freelance, produits, services" />
    
    <!-- MANIFEST -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- APPLE ICONS -->
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Digital Market Space" />
    
    <title>Digital Market Space</title>

    <style>
        /* Style de base pour le chargement */
        #root {
            min-height: 100vh;
        }
        
        /* Style pour le bouton d'installation PWA */
        .pwa-install-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 50px;
            cursor: pointer;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .pwa-install-btn:hover {
            transform: scale(1.05);
            background: #3730a3;
        }
    </style>
</head>
<body>
    <div id="root">
        <!-- Votre app React se charge ici -->
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh;">
            <div style="text-align: center;">
                <div style="font-size: 2rem; margin-bottom: 1rem;">üîÑ</div>
                <p>Chargement Digital Market Space...</p>
            </div>
        </div>
    </div>

    <!-- PWA SCRIPT -->
    <script>
        // Enregistrement du Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('‚úÖ ServiceWorker enregistr√© avec scope:', registration.scope);
                        
                        // V√©rifier les mises √† jour
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('üîÑ Nouveau Service Worker trouv√©...');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('üì¶ Nouvelle version disponible!');
                                    // Vous pouvez afficher un message √† l'utilisateur ici
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.log('‚ùå √âchec enregistrement ServiceWorker:', error);
                    });
            });

            // √âcouter les changements de Service Worker
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                console.log('üéØ Controller chang√© - rechargement de la page');
                window.location.reload();
            });
        }

        // Gestion de l'installation PWA
        let deferredPrompt;
        const installBtn = document.createElement('button');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('üì± PWA pr√™te pour installation');
            
            showInstallButton();
        });

        function showInstallButton() {
            installBtn.className = 'pwa-install-btn';
            installBtn.innerHTML = 'üì± Installer App';
            installBtn.onclick = installPWA;
            
            document.body.appendChild(installBtn);
            
            // Cacher apr√®s 20 secondes
            setTimeout(() => {
                if (installBtn.parentNode) {
                    installBtn.remove();
                }
            }, 20000);
        }

        async function installPWA() {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('üéâ PWA install√©e avec succ√®s!');
                installBtn.remove();
            } else {
                console.log('‚ùå Installation refus√©e');
            }
            
            deferredPrompt = null;
        }

        // Cacher le bouton si d√©j√† install√©
        window.addEventListener('appinstalled', (evt) => {
            console.log('üè† DMS install√© avec succ√®s');
            if (installBtn.parentNode) {
                installBtn.remove();
            }
        });

        // V√©rifier si d√©j√† en mode PWA
        if (window.matchMedia('(display-mode: standalone)').matches) {
            console.log('üì± D√©j√† en mode PWA');
        }
    </script>
</body>
</html>